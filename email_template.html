<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 화물/물류 뉴스</title>
</head>

<body
    style="font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; margin: 0; padding: 0; background-color: #f6f8fa;">

    <div
        style="width: 100%; max-width: 720px; margin: 20px auto; background-color: #ffffff; border: 1px solid #e1e4e8; border-radius: 6px;">

        <div style="width: 100%;">
            <img src="{% if target == 'web' %}../assets/logicharacter.png{% else %}cid:newsletter_banner{% endif %}"
                alt="로디의 물류 뉴스레터 배너"
                style="width: 100%; border-top-left-radius: 6px; border-top-right-radius: 6px; display: block;">
        </div>

        <div style="padding: 24px; text-align: center; border-bottom: 1px solid #e1e4e8;">
            <h1 style="margin: 0; font-size: 24px; color: #6A9EDA;">{{ title }}</h1>
            <p style="margin: 5px 0 0; color: #586069;">{{ today_date }}</p>
        </div>

        {% if has_weather_dashboard %}
        <div style="padding: 24px 0; border-bottom: 1px solid #e1e4e8;">
            <img src="{{ weather_dashboard_src }}" style="width:100%; max-width:1000px; height:auto;"
                alt="주간 운송 날씨 리스크">
        </div>
        {% endif %}

        {% if ai_briefing %}
        <div style="padding: 24px; border-bottom: 1px solid #e1e4e8; background-color: #f6f8fa;">
            <div style="color: #444c56; line-height: 1.7; font-size: 14px;">
                {{ ai_briefing | safe }}
            </div>
        </div>
        {% endif %}

        {% if risk_events %} {# risk_calendar_html 대신 risk_events가 있는지 확인합니다. #}
        <div style="padding: 24px; background-color: #f6f8fa;">
            <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #333; text-align: center;">🚨 주요 리스크 목록</h3>

            {% for event in risk_events %}
            {% if event.date_range[0] >= date.today() %}
            <div
                style="margin-bottom: 15px; background-color: #ffffff; border: 1px solid #e1e4e8; border-radius: 8px; padding: 15px;">
                <p style="margin: 0 0 8px; font-weight: bold; color: #24292e;">
                    • {{ event.name }}
                    ({% if event.date_range[0] == event.date_range[1] %}{{ event.date_range[0].strftime('%m/%d') }}{%
                    else %}{{ event.date_range[0].strftime('%m/%d') }}~{{ event.date_range[1].strftime('%m/%d') }}{%
                    endif %})
                </p>
                <p style="margin: 0 0 10px; font-size: 14px; color: #444c56; line-height: 1.6;">{{ event.risk_summary }}
                </p>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% endif %}

        {% if price_indicators and price_indicators.city_prices %}
        <div style="padding: 24px; border-bottom: 1px solid #e1e4e8;">
            <div style="background-color: #f7f7f7; padding: 15px; border-radius: 8px;">
                <h3 style="margin: 0 0 10px 0; font-size: 16px; color: #333; text-align: center;">📈 오늘의 운송 주요 지표</h3>
                <p style="text-align: right; font-size: 11px; color: #888; margin: -5px 0 10px 0;">({{
                    price_indicators.timestamp }})</p>

                <div style="margin-bottom: 15px;">
                    <img src="{{ price_chart_src }}" alt="최근 7일 유가 추이"
                        style="max-width: 100%; height: auto; border-radius: 6px; display: block;">
                </div>

                {% if price_indicators.city_prices %}
                <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                    <thead>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <th style="padding: 6px; text-align: left; color: #333;">도시</th>
                            <th style="padding: 6px; text-align: right; color: #333;">휘발유</th>
                            <th style="padding: 6px; text-align: right; color: #333;">경유</th>
                            <th style="padding: 6px; text-align: right; color: #333;">요소수</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for city in price_indicators.city_prices %}
                        <tr style="border-bottom: 1px solid #eee;">
                            <td style="padding: 6px; text-align: left;"><strong>{{ city.name }}</strong></td>
                            <td style="padding: 6px; text-align: right;">{{ city.gasoline | default('-', true) }}</td>
                            <td style="padding: 6px; text-align: right;">{{ city.diesel | default('-', true) }}</td>
                            <td style="padding: 6px; text-align: right;">{{ city.urea | default('-', true) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}

                {% if price_indicators.trend_comment %}
                <p
                    style="margin: 10px 0 0 0; font-size: 12px; color: #586069; text-align: center; border-top: 1px solid #eee; padding-top: 10px;">
                    {{ price_indicators.trend_comment }}
                </p>
                {% endif %}

            </div>
        </div>
        {% endif %}

        <div style="padding: 24px;">
            {% for news in news_list %}

            <div>
                {% if news.image_data or news.image_src %}
                <div style="margin-bottom: 16px;">
                    <table border="0" cellpadding="0" cellspacing="0" width="100%" role="presentation">
                        <tr>
                            <td align="center">
                                <a href="{{ news.link }}" target="_blank" style="text-decoration: none;">
                                    {% if news.image_src %}
                                    <img src="{{ news.image_src }}" width="{{ news.image_final_width }}"
                                        alt="Article Thumbnail"
                                        style="display: block; max-width: 100%; height: auto; border: 0; border-radius: 6px;">
                                    {% else %}
                                    <img src="cid:{{ news.image_cid }}" width="{{ news.image_final_width }}"
                                        height="{{ news.image_final_height }}" alt="Article Thumbnail"
                                        style="display: block; max-width: 100%; height: auto; border: 0; border-radius: 6px;">
                                    {% endif %}
                                </a>
                            </td>
                        </tr>
                    </table>
                </div>
                {% endif %}

                <h3 style="margin: 0 0 10px 0; font-size: 18px;">
                    <a href="{{ news.link }}" target="_blank"
                        style="color: #6A9EDA; text-decoration: none; font-weight: 600;">{{ news.title }}</a>
                </h3>

                <p style="margin: 0; color: #444c56; line-height: 1.7; font-size: 14px;">
                    {% if news.ai_summary %}
                    {{ news.ai_summary | replace('\n', '<br>') | safe }}
                    {% else %}
                    {{ news.summary }}
                    {% endif %}
                </p>

                {% if not loop.last %}
                <hr style="border: 0; border-top: 1px solid #e1e4e8; margin: 24px 0;">
                {% endif %}
            </div>
            {% endfor %}
        </div>

{% if zodiac_horoscopes %}
<div style="padding: 24px; border-top: 1px solid #e1e4e8; background-color: #f6f8fa;">
    <h3 style="margin: 0 0 20px 0; font-size: 16px; color: #333; text-align: center;">오늘의 운세, 로디가 알려줄게요! 🔮</h3>

    <p style="text-align: center; margin-bottom: 20px;">
        <img src="{% if target == 'web' %}../assets/fortunechar.png{% else %}cid:fortunechar.png{% endif %}"
             alt="로디의 오늘의 운세" width="500"
             style="max-width: 100%; height: auto; display: block; margin: 0 auto; border-radius: 8px;">
    </p>

    <div style="display: flex; flex-wrap: wrap; margin: 0 -5px;">
        {% for h in zodiac_horoscopes %}
        <div style="width: 50%; padding: 5px; box-sizing: border-box; display: flex; flex-direction: column;">
            <div
                style="background-color: #ffffff; border: 1px solid #e1e4e8; border-radius: 8px; padding: 15px; flex-grow: 1;">
                <p style="margin: 0 0 10px; font-size: 16px; font-weight: bold; color: #24292e;">{{ h.emoji }}
                    {{ h.name }}띠</p>
                <p style="margin: 0; padding: 12px; background-color: #f6f8fa; border-radius: 6px; color: #444c56; line-height: 1.6; font-size: 14px;">
                    "{{ h.fortune }}"
                </p>
                </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}


        <div style="padding: 24px; border-top: 1px solid #e1e4e8; background-color: #f6f8fa; text-align: center;">
            <h4 style="margin: 0 0 10px 0; color: #6A9EDA;">오늘의 뉴스레터가 좋으셨다면 공유해주세요.</h4>
            <p style="margin: 0; font-size: 13px; color: #586069;">아래 링크를 복사해서 동료에게 전달할 수 있습니다.</p>
            <p
                style="margin-top: 10px; padding: 8px 12px; background-color: #fff; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; -webkit-user-select: all; -moz-user-select: all; -ms-user-select: all; user-select: all;">
                https://Tonyflyy.github.io/logistics-news-automation/archive/{{ today_date }}.html
            </p>
        </div>

        <div style="text-align: center; padding: 24px; font-size: 12px; color: #586069; border-top: 1px solid #e1e4e8;">
            <p style="margin: 0;">YLP 뉴스레터</p>
            <p style="margin: 10px 0 0;">
                YLP화물: <a href="https://www.tmapfreight.com/" style="color: #6A9EDA; text-decoration: none;">사이트
                    바로가기</a>
                | <a href="https://Tonyflyy.github.io/logistics-news-automation/archive/index.html" target="_blank"
                    style="color: #6A9EDA; text-decoration: none;">지난 뉴스레터 보기</a>
            </p>
        </div>

    </div>

</body>

</html>


